@page "/"
@inject IMiniMain MiniMain
@using System.Collections.Generic
@using System.Linq
@using Repos;
@using Minitwit.Entities;
@inject NavigationManager NavigationManager
@inject IMessageRepository MessageRepository

<h2>@MiniMain.User.username 's Timeline</h2>//

<div class=twitbox>
        <h3>What's on your mind @MiniMain.User.username ?</h3>
        <form action="{{ url_for('add_message') }}" method=post>
        <input type=text name=text size=60>
        <input type=submit value="Share">
    </form>
</div>

<ul class=messages>
    @* {% for message in messages %} *@
    @if (MiniMain.UserMessageDTO.ToList().Count > 0)
    {
        @foreach (var message in @MiniMain.UserMessageDTO)
        {
            <li><img src=@MiniMain.GravatarUrl(message.email, 48)>
            <strong><a href=@MiniMain.UrlForUser(message.username)>@message.username</a></strong>
            @message.text
            <small>&mdash; @message.pub_date |datetimeformat </small></li> 
        }
    }
    else
    {
        <li><em>There's no messages so far</em></li>
    }
</ul>

@code {
     protected override void OnInitialized()
    {
        if (MiniMain.User.user_id <= -1) NavigationManager.NavigateTo("public");

        MiniMain.UserMessageDTO = new List<UserMessageDTO>();

        MiniMain.Timeline();
    }
}